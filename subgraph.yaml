specVersion: 0.0.2
description: Zero subgraph
repository: https://github.com/DistributedCollective/Sovryn-subgraph
schema:
  file: ./schema.graphql

dataSources:
  - name: TroveManager
    kind: ethereum/contract
    network: mainnet
    source:
      abi: TroveManager
      address: "0x0464f1dc6C28D71C849c623610d33a45ce135B39"
      startBlock: 2383375
    mapping:
      file: ./src/mappings/TroveManager.ts
      language: wasm/assemblyscript
      kind: ethereum/events
      apiVersion: 0.0.5
      entities:
        - Global
        - User
        - Transaction
        - Trove
        - TroveChange
        - Redemption
        - Liquidation
        - SystemState
      abis:
        - name: TroveManager
          file: ./abi/TroveManager.json
      eventHandlers:
        - event: TroveUpdated(indexed address,uint256,uint256,uint256,uint8)
          handler: handleTroveUpdated
        - event: TroveLiquidated(indexed address,uint256,uint256,uint8)
          handler: handleTroveLiquidated
        - event: Liquidation(uint256,uint256,uint256,uint256)
          handler: handleLiquidation
        - event: Redemption(uint256,uint256,uint256,uint256)
          handler: handleRedemption
        - event: LTermsUpdated(uint256,uint256)
          handler: handleLTermsUpdated

  - name: BorrowerOperations
    kind: ethereum/contract
    network: mainnet
    source:
      abi: BorrowerOperations
      address: "0x71F14023E3eEACdD028E49a6776E81BB04d60b98"
      startBlock: 2383375
    mapping:
      file: ./src/mappings/BorrowerOperations.ts
      language: wasm/assemblyscript
      kind: ethereum/events
      apiVersion: 0.0.5
      entities:
        - Global
        - User
        - Transaction
        - Trove
        - TroveChange
        - SystemState
      abis:
        - name: BorrowerOperations
          file: ./abi/BorrowerOperations.json
      eventHandlers:
        - event: TroveUpdated(indexed address,uint256,uint256,uint256,uint8)
          handler: handleTroveUpdated
        - event: ZUSDBorrowingFeePaid(indexed address,uint256)
          handler: handleZUSDBorrowingFeePaid

  - name: PriceFeed
    kind: ethereum/contract
    network: mainnet
    source:
      abi: PriceFeed
      address: "0x46025a89d6F1BFfD1C0Ae9E98e39725e54A11e60"
      startBlock: 2383375
    mapping:
      file: ./src/mappings/PriceFeed.ts
      language: wasm/assemblyscript
      kind: ethereum/events
      apiVersion: 0.0.5
      entities:
        - Global
        - Transaction
        - PriceChange
        - SystemState
      abis:
        - name: PriceFeed
          file: ./abi/PriceFeed.json
      eventHandlers:
        - event: LastGoodPriceUpdated(uint256)
          handler: handleLastGoodPriceUpdated

  - name: StabilityPool
    kind: ethereum/contract
    network: mainnet
    source:
      abi: StabilityPool
      address: "0x0DcedF5e080ED1D58B27b030d042D60971408D26"
      startBlock: 2383375
    mapping:
      file: ./src/mappings/StabilityPool.ts
      language: wasm/assemblyscript
      kind: ethereum/events
      apiVersion: 0.0.5
      entities:
        - Global
        - User
        - Transaction
        - StabilityDeposit
        - StabilityDepositChange
        - SystemState
        # - Frontend
      abis:
        - name: StabilityPool
          file: ./abi/StabilityPool.json
      eventHandlers:
        - event: UserDepositChanged(indexed address,uint256)
          handler: handleUserDepositChanged
        - event: RBTCGainWithdrawn(indexed address,uint256,uint256)
          handler: handleETHGainWithdrawn
        # - event: FrontEndRegistered(indexed address,uint256)
        #   handler: handleFrontendRegistered
        # - event: FrontEndTagSet(indexed address,indexed address)
        #   handler: handleFrontendTagSet

  - name: CollSurplusPool
    kind: ethereum/contract
    network: mainnet
    source:
      abi: CollSurplusPool
      address: "0xAC0Bcbf50f27a60647109A229c4409E1369350C3"
      startBlock: 2383375
    mapping:
      file: ./src/mappings/CollSurplusPool.ts
      language: wasm/assemblyscript
      kind: ethereum/events
      apiVersion: 0.0.5
      entities:
        - Global
        - User
        - Transaction
        - Trove
        - CollSurplusChange
        - SystemState
      abis:
        - name: CollSurplusPool
          file: ./abi/CollSurplusPool.json
      eventHandlers:
        - event: CollBalanceUpdated(indexed address,uint256)
          handler: handleCollSurplusBalanceUpdated

  - name: ZUSDToken
    kind: ethereum/contract
    network: mainnet
    source:
      abi: ERC20
      address: "0x71A2D1f9611eA45181aee147A84673f355894D70"
      startBlock: 2383375
    mapping:
      file: ./src/mappings/Token.ts
      language: wasm/assemblyscript
      kind: ethereum/events
      apiVersion: 0.0.5
      entities:
        - Global
        - User
        - Transaction
        - Token
      abis:
        - name: ERC20
          file: ./abi/ERC20.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTokenTransfer
        - event: Approval(indexed address,indexed address,uint256)
          handler: handleTokenApproval

  - kind: ethereum/contract
    name: ActivePool
    network: mainnet
    source:
      address: '0x4AaffD5a31dEe60c1a07fCf93a012666310A155a'
      abi: ActivePool
      startBlock: 2383375
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.5
      language: wasm/assemblyscript
      entities:
        - ActivePoolAddressChanged
        - ActivePoolETHBalanceUpdated
        - ActivePoolZUSDDebtUpdated
        - BorrowerOperationsAddressChanged
        - DefaultPoolAddressChanged
        - ETHBalanceUpdated
        - EtherSent
        - OwnershipTransferred
        - StabilityPoolAddressChanged
        - TroveManagerAddressChanged
        - ZUSDBalanceUpdated
      abis:
        - name: ActivePool
          file: ./abi/ActivePool.json
      eventHandlers:
        - event: EtherSent(address,uint256)
          handler: handleEtherSent
      file: ./src/mappings/ActivePool.ts
